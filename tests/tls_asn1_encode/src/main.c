#include <ti/screen.h>
#include <ti/getkey.h>
#include <stdlib.h>
#include <string.h>
#include <stdio.h>

#include "tls/includes/asn1.h"
#include "tls/includes/base64.h"

// test vectors
// A 2048 bit public key
uint8_t key[] = {0xb2,0xf2,0xaa,0x2e,0x61,0x08,0xce,0xfa,0xa9,0x17,0x3f,0xdc,0xe3,0x50,0x15,0xf3,0xe8,0xd2,0xd1,0x52,0x58,0xa5,0x81,0x60,0xad,0xc1,0x9b,0x77,0xb0,0x90,0xc0,0x06,0xee,0x2b,0xeb,0xa1,0x4f,0x09,0x3e,0x94,0xa4,0xfa,0x56,0x4d,0xd0,0x3f,0x7f,0xa2,0xac,0x0d,0xb1,0x89,0x20,0x04,0x0b,0x3a,0xc4,0x46,0xb8,0x74,0xfc,0x30,0x07,0x59,0xb1,0x01,0xe1,0xd9,0xb9,0x5b,0x6d,0xa5,0xdd,0xba,0x94,0xd8,0x57,0xbc,0x04,0x98,0xc3,0x46,0x72,0x2c,0x14,0x01,0x04,0x3f,0x70,0x39,0x3f,0xa4,0xd7,0x57,0x5e,0x79,0x5d,0x80,0xcc,0x24,0xfd,0x3c,0x05,0x9e,0xca,0xc1,0x9d,0x8f,0x32,0x3a,0x7e,0xa0,0xbc,0xa4,0x86,0x4e,0x00,0xfb,0x5e,0x2a,0x69,0x91,0x9b,0xb5,0x39,0xa5,0x98,0x69,0x5e,0xdc,0x0a,0x31,0x66,0x91,0x7f,0xb4,0x4a,0xbd,0xbf,0x6f,0xb9,0x3c,0x2a,0x62,0xc2,0x20,0x64,0x04,0x38,0x50,0x95,0x7b,0xde,0x97,0xed,0xa9,0xb0,0xdb,0x6a,0xfd,0x82,0xbc,0xd6,0x8b,0x6f,0xba,0xe8,0x0c,0x15,0x5d,0x88,0x5f,0x9c,0x3b,0x64,0x89,0xdb,0x8b,0xf4,0x1d,0xb2,0x81,0xf0,0x36,0x78,0x29,0x67,0x05,0x05,0xda,0xe9,0x3b,0x5b,0xae,0x40,0x13,0xea,0x50,0x8b,0xb4,0x20,0xd6,0x6d,0x83,0xb0,0xe8,0xeb,0x71,0x64,0xc4,0x91,0x32,0x76,0xb6,0xa5,0xbe,0xaf,0x1e,0x63,0xa5,0xeb,0xd3,0x91,0xf2,0x22,0xf1,0xe3,0x25,0xb8,0xaf,0xb8,0x81,0xbf,0x28,0x52,0x57,0x71,0x9f,0xf5,0x66,0xc8,0xc4,0x8e,0xd6,0xaa,0x67,0xea,0xad,0xb7,0x5f,0x42,0xe6,0xdc,0xbb,0xe3,0x15};

size_t pub_exponent = 65537;

uint8_t asn1_buf[300];
uint8_t asn1_buf2[300];

uint8_t expected[] = {0x30,0x82,0x01,0x09,0x02,0x82,0x01,0x00,0xB2,0xF2,0xAA,0x2E,0x61,0x08,0xCE,0xFA,0xA9,0x17,0x3F,0xDC,0xE3,0x50,0x15,0xF3,0xE8,0xD2,0xD1,0x52,0x58,0xA5,0x81,0x60,0xAD,0xC1,0x9B,0x77,0xB0,0x90,0xC0,0x06,0xEE,0x2B,0xEB,0xA1,0x4F,0x09,0x3E,0x94,0xA4,0xFA,0x56,0x4D,0xD0,0x3F,0x7F,0xA2,0xAC,0x0D,0xB1,0x89,0x20,0x04,0x0B,0x3A,0xC4,0x46,0xB8,0x74,0xFC,0x30,0x07,0x59,0xB1,0x01,0xE1,0xD9,0xB9,0x5B,0x6D,0xA5,0xDD,0xBA,0x94,0xD8,0x57,0xBC,0x04,0x98,0xC3,0x46,0x72,0x2C,0x14,0x01,0x04,0x3F,0x70,0x39,0x3F,0xA4,0xD7,0x57,0x5E,0x79,0x5D,0x80,0xCC,0x24,0xFD,0x3C,0x05,0x9E,0xCA,0xC1,0x9D,0x8F,0x32,0x3A,0x7E,0xA0,0xBC,0xA4,0x86,0x4E,0x00,0xFB,0x5E,0x2A,0x69,0x91,0x9B,0xB5,0x39,0xA5,0x98,0x69,0x5E,0xDC,0x0A,0x31,0x66,0x91,0x7F,0xB4,0x4A,0xBD,0xBF,0x6F,0xB9,0x3C,0x2A,0x62,0xC2,0x20,0x64,0x04,0x38,0x50,0x95,0x7B,0xDE,0x97,0xED,0xA9,0xB0,0xDB,0x6A,0xFD,0x82,0xBC,0xD6,0x8B,0x6F,0xBA,0xE8,0x0C,0x15,0x5D,0x88,0x5F,0x9C,0x3B,0x64,0x89,0xDB,0x8B,0xF4,0x1D,0xB2,0x81,0xF0,0x36,0x78,0x29,0x67,0x05,0x05,0xDA,0xE9,0x3B,0x5B,0xAE,0x40,0x13,0xEA,0x50,0x8B,0xB4,0x20,0xD6,0x6D,0x83,0xB0,0xE8,0xEB,0x71,0x64,0xC4,0x91,0x32,0x76,0xB6,0xA5,0xBE,0xAF,0x1E,0x63,0xA5,0xEB,0xD3,0x91,0xF2,0x22,0xF1,0xE3,0x25,0xB8,0xAF,0xB8,0x81,0xBF,0x28,0x52,0x57,0x71,0x9F,0xF5,0x66,0xC8,0xC4,0x8E,0xD6,0xAA,0x67,0xEA,0xAD,0xB7,0x5F,0x42,0xE6,0xDC,0xBB,0xE3,0x15,0x02,0x03,0x01,0x00,0x01};

/* Main function, called first */
int main(void)
{
    /* Clear the homescreen */
    os_ClrHome();
    size_t offset = 0;
    
    offset += tls_asn1_encode_segment(ASN1_INTEGER, key, sizeof key, &asn1_buf[offset]);
    offset += tls_asn1_encode_segment(ASN1_INTEGER, (uint8_t*)&pub_exponent, sizeof pub_exponent, &asn1_buf[offset]);
    
    tls_asn1_encode_segment(ASN1_SEQUENCE, asn1_buf, offset, asn1_buf2);
   
    if(memcmp(asn1_buf2, expected, sizeof expected)==0)
        printf("success");
    else printf("failed");
    os_GetKey();
    os_ClrHome();
    
    return 0;
}
